<!doctype html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <style>
         html, body, #jsdos {
             width: 100%;
             height: 100%;
             margin: 0;
             padding: 0;
         }
         .fakehidden {width: 1px !important; height: 1px !important; display: absolute; }
        </style>
        <script src="js-dos/js-dos.js"></script>
        <link href="js-dos/js-dos.css" rel="stylesheet">
    </head>
    <body>
        <div class="fakehidden" id="jsdos"></div>
        <div id="root"></div>
        <script type="module">
            import * as THREE from 'https://unpkg.com/three@latest/build/three.module.js';

            emulators.pathPrefix = "js-dos/";
            const gameDiv = document.getElementById("jsdos");
            console.dir(gameDiv);

            let original_canvas = 0;
            
            window.onload = function() {
                Dos(document.getElementById("jsdos")).run("wordlos.jsdos");
                const img = original_canvas = document.getElementsByClassName("emulator-canvas")[0];
                img.width = 640;
                img.height = 400;


                const ctx = img.getContext('2d');
                const texture = new THREE.CanvasTexture(img);
                texture.magFilter = THREE.NearestFilter;

                const scene = new THREE.Scene();
                scene.background = new THREE.Color();

                const camera = new THREE.PerspectiveCamera( 40, window.innerWidth/window.innerHeight, 0.1, 1000 );
                const renderer = new THREE.WebGLRenderer();
                renderer.setSize( window.innerWidth, window.innerHeight );

                document.getElementById("root").appendChild(renderer.domElement);

                const geometry = new THREE.PlaneGeometry(2, 1.3);
                const material = new THREE.MeshBasicMaterial({
                    map: texture,
                });
                const cube = new THREE.Mesh( geometry, material );

                scene.add( cube );
                camera.position.z = 2;

                const animate = function () {
                        requestAnimationFrame( animate );
                        texture.needsUpdate = true;
                        gameDiv.focus({focusVisible: true});
                        renderer.render( scene, camera );
                };

                animate();
            };

        </script>
    </body>
</html>